function c(e){return e.nodeType===Node.ELEMENT_NODE}function p(e,t=null,r){const n=document.createElement(e);Array.isArray(t)?n.classList.add(...t):t&&n.classList.add(t);for(const e in r)n[e]=r[e];return n}function g(e){const t=p("div");return t.appendChild(e),t.innerHTML}function C(e){let t;return e.nodeType!==Node.ELEMENT_NODE?t=e.textContent:(t=e.innerHTML,t=t.replaceAll("<br>","")),0===(null==t?void 0:t.trim().length)}!function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode('.cdx-nested-list{margin:0;padding:0;outline:none;counter-reset:item;list-style:none}.cdx-nested-list__item{line-height:1.6em;display:flex;margin:2px 0}.cdx-nested-list__item [contenteditable]{outline:none}.cdx-nested-list__item-body{flex-grow:2}.cdx-nested-list__item-content,.cdx-nested-list__item-children{flex-basis:100%}.cdx-nested-list__item-content{word-break:break-word;white-space:pre-wrap}.cdx-nested-list__item:before{counter-increment:item;margin-right:5px;white-space:nowrap}.cdx-nested-list--ordered>.cdx-nested-list__item:before{content:counters(item,".") ". "}.cdx-nested-list--unordered>.cdx-nested-list__item:before{content:"â€¢"}.cdx-nested-list__settings{display:flex}.cdx-nested-list__settings .cdx-settings-button{width:50%}')),document.head.appendChild(e)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}}();class u{constructor(){this.savedFakeCaret=void 0}save(){const e=u.range,t=p("span");t.hidden=!0,e&&(e.insertNode(t),this.savedFakeCaret=t)}restore(){if(!this.savedFakeCaret)return;const e=window.getSelection();if(!e)return;const t=new Range;t.setStartAfter(this.savedFakeCaret),t.setEndAfter(this.savedFakeCaret),e.removeAllRanges(),e.addRange(t),setTimeout((()=>{var e;null==(e=this.savedFakeCaret)||e.remove()}),150)}static get range(){const e=window.getSelection();return e&&e.rangeCount?e.getRangeAt(0):null}static extractFragmentFromCaretPositionTillTheEnd(){const e=window.getSelection();if(!e||!e.rangeCount)return;const t=e.getRangeAt(0);let r=t.startContainer;if(r.nodeType!==Node.ELEMENT_NODE){if(!r.parentNode)return;r=r.parentNode}if(!c(r))return;const n=r.closest("[contenteditable]");if(!n)return;t.deleteContents();const s=t.cloneRange();return s.selectNodeContents(n),s.setStart(t.endContainer,t.endOffset),s.extractContents()}static focus(e,t=!0){const r=document.createRange(),n=window.getSelection();n&&(r.selectNodeContents(e),r.collapse(t),n.removeAllRanges(),n.addRange(r))}static isAtStart(){const e=window.getSelection();if(!e||e.focusOffset>0)return!1;const t=e.focusNode;return!(!t||!c(t))&&u.getHigherLevelSiblings(t,"left").every((e=>C(e)))}static getHigherLevelSiblings(e,t="left"){let r=e;const n=[];for(;r.parentNode&&"true"!==r.parentNode.contentEditable;)r=r.parentNode;const s="left"===t?"previousSibling":"nextSibling";for(;r[s];)r=r[s],n.push(r);return n}}const w='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><line x1="9" x2="19" y1="7" y2="7" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><line x1="9" x2="19" y1="12" y2="12" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><line x1="9" x2="19" y1="17" y2="17" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M5.00001 17H4.99002"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M5.00001 12H4.99002"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M5.00001 7H4.99002"/></svg>',S='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><line x1="12" x2="19" y1="7" y2="7" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><line x1="12" x2="19" y1="12" y2="12" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><line x1="12" x2="19" y1="17" y2="17" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M7.79999 14L7.79999 7.2135C7.79999 7.12872 7.7011 7.0824 7.63597 7.13668L4.79999 9.5"/></svg>';class f{static get isReadOnlySupported(){return!0}static get enableLineBreaks(){return!0}static get toolbox(){return{icon:S,title:"List"}}constructor({data:e,config:t,api:r,readOnly:n}){var s;this.nodes={wrapper:null},this.api=r,this.readOnly=n,this.config=t,this.defaultListStyle="ordered"===(null==(s=this.config)?void 0:s.defaultStyle)?"ordered":"unordered";const i={style:this.defaultListStyle,items:[]};this.data=e&&Object.keys(e).length?e:i,this.caret=new u}render(){return this.nodes.wrapper=this.makeListWrapper(this.data.style,[this.CSS.baseBlock]),this.data.items.length?this.appendItems(this.data.items,this.nodes.wrapper):this.appendItems([{content:"",items:[]}],this.nodes.wrapper),this.readOnly||this.nodes.wrapper.addEventListener("keydown",(e=>{switch(e.key){case"Enter":this.enterPressed(e);break;case"Backspace":this.backspace(e);break;case"Tab":e.shiftKey?this.shiftTab(e):this.addTab(e)}}),!1),this.nodes.wrapper}renderSettings(){return[{name:"unordered",label:this.api.i18n.t("Unordered"),icon:w},{name:"ordered",label:this.api.i18n.t("Ordered"),icon:S}].map((e=>({name:e.name,icon:e.icon,label:e.label,isActive:this.data.style===e.name,closeOnActivate:!0,onActivate:()=>{this.listStyle=e.name}})))}static get pasteConfig(){return{tags:["OL","UL","LI"]}}onPaste(e){const t=e.detail.data;this.data=this.pasteHandler(t);const r=this.nodes.wrapper;r&&r.parentNode&&r.parentNode.replaceChild(this.render(),r)}pasteHandler(e){const{tagName:t}=e;let r,n="unordered";switch(t){case"OL":n="ordered",r="ol";break;case"UL":case"LI":n="unordered",r="ul"}const s={style:n,items:[]},i=e=>Array.from(e.querySelectorAll(":scope > li")).map((e=>{var t;const n=e.querySelector(`:scope > ${r}`),s=n?i(n):[];return{content:(null==(t=null==e?void 0:e.firstChild)?void 0:t.textContent)||"",items:s}}));return s.items=i(e),s}appendItems(e,t){e.forEach((e=>{const r=this.createItem(e.content,e.items);t.appendChild(r)}))}createItem(e,t=[]){const r=p("li",this.CSS.item),n=p("div",this.CSS.itemBody),s=p("div",this.CSS.itemContent,{innerHTML:e,contentEditable:(!this.readOnly).toString()});return n.appendChild(s),r.appendChild(n),t&&t.length>0&&this.addChildrenList(r,t),r}save(){const e=t=>Array.from(t.querySelectorAll(`:scope > .${this.CSS.item}`)).map((t=>{const r=t.querySelector(`.${this.CSS.itemChildren}`);return{content:this.getItemContent(t),items:r?e(r):[]}}));return{style:this.data.style,items:this.nodes.wrapper?e(this.nodes.wrapper):[]}}addChildrenList(e,t){const r=e.querySelector(`.${this.CSS.itemBody}`),n=this.makeListWrapper(void 0,[this.CSS.itemChildren]);this.appendItems(t,n),r&&r.appendChild(n)}makeListWrapper(e=this.listStyle,t=[]){const r="ordered"===e?"ol":"ul",n="ordered"===e?this.CSS.wrapperOrdered:this.CSS.wrapperUnordered;return t.push(n),p(r,[this.CSS.wrapper,...t])}get CSS(){return{baseBlock:this.api.styles.block,wrapper:"cdx-nested-list",wrapperOrdered:"cdx-nested-list--ordered",wrapperUnordered:"cdx-nested-list--unordered",item:"cdx-nested-list__item",itemBody:"cdx-nested-list__item-body",itemContent:"cdx-nested-list__item-content",itemChildren:"cdx-nested-list__item-children",settingsWrapper:"cdx-nested-list__settings",settingsButton:this.api.styles.settingsButton,settingsButtonActive:this.api.styles.settingsButtonActive}}get listStyle(){return this.data.style||this.defaultListStyle}set listStyle(e){if(!this.nodes||!this.nodes.wrapper)return;const t=Array.from(this.nodes.wrapper.querySelectorAll(`.${this.CSS.wrapper}`));t.push(this.nodes.wrapper),t.forEach((t=>{t.classList.toggle(this.CSS.wrapperUnordered,"unordered"===e),t.classList.toggle(this.CSS.wrapperOrdered,"ordered"===e)})),this.data.style=e}get currentItem(){const e=window.getSelection();if(!e)return null;let t=e.anchorNode;return t&&(c(t)||(t=t.parentNode),t)&&c(t)?t.closest(`.${this.CSS.item}`):null}enterPressed(e){const t=this.currentItem;if(e.stopPropagation(),e.preventDefault(),e.isComposing)return;const r=!t||0===this.getItemContent(t).trim().length,n=(null==t?void 0:t.parentNode)===this.nodes.wrapper,s=null===(null==t?void 0:t.nextElementSibling);if(n&&s&&r)return void this.getOutOfList();if(s&&r)return void this.unshiftItem();const i=u.extractFragmentFromCaretPositionTillTheEnd();if(!i)return;const o=g(i),a=null==t?void 0:t.querySelector(`.${this.CSS.itemChildren}`),d=this.createItem(o,void 0);a&&Array.from(a.querySelectorAll(`.${this.CSS.item}`)).length>0?a.prepend(d):null==t||t.after(d),this.focusItem(d)}unshiftItem(){const e=this.currentItem;if(!e||!e.parentNode||!c(e.parentNode))return;const t=e.parentNode.closest(`.${this.CSS.item}`);if(!t)return;this.caret.save(),t.after(e),this.caret.restore();const r=t.querySelector(`.${this.CSS.itemChildren}`);r&&0===r.children.length&&r.remove()}getItemContent(e){const t=e.querySelector(`.${this.CSS.itemContent}`);return!t||C(t)?"":t.innerHTML}focusItem(e,t=!0){const r=e.querySelector(`.${this.CSS.itemContent}`);r&&u.focus(r,t)}getOutOfList(){var e;null==(e=this.currentItem)||e.remove(),this.api.blocks.insert(),this.api.caret.setToBlock(this.api.blocks.getCurrentBlockIndex())}backspace(e){if(!u.isAtStart())return;e.preventDefault();const t=this.currentItem;if(!t)return;const r=t.previousSibling;if(!t.parentNode||!c(t.parentNode))return;const n=t.parentNode.closest(`.${this.CSS.item}`);if(!r&&!n||r&&!c(r))return;let s;if(e.stopPropagation(),r){const e=r.querySelectorAll(`.${this.CSS.item}`);s=Array.from(e).pop()||r}else s=n;const i=u.extractFragmentFromCaretPositionTillTheEnd();if(!i)return;const o=g(i);if(!s)return;const a=s.querySelector(`.${this.CSS.itemContent}`);if(!a)return;u.focus(a,!1),this.caret.save(),a.insertAdjacentHTML("beforeend",o);let d=t.querySelectorAll(`.${this.CSS.itemChildren} > .${this.CSS.item}`);d=Array.from(d),d=d.filter((e=>!(!e.parentNode||!c(e.parentNode))&&e.parentNode.closest(`.${this.CSS.item}`)===t)),d.reverse().forEach((e=>{r?s.after(e):t.after(e)})),t.remove(),this.caret.restore()}addTab(e){e.stopPropagation(),e.preventDefault();const t=this.currentItem;if(!t)return;const r=t.previousSibling;if(!r||!c(r)||!r)return;const n=r.querySelector(`.${this.CSS.itemChildren}`);if(this.caret.save(),n)n.appendChild(t);else{const e=this.makeListWrapper(void 0,[this.CSS.itemChildren]),n=r.querySelector(`.${this.CSS.itemBody}`);e.appendChild(t),null==n||n.appendChild(e)}this.caret.restore()}shiftTab(e){e.stopPropagation(),e.preventDefault(),this.unshiftItem()}static joinRecursive(e){return e.items.map((e=>`${e.content} ${f.joinRecursive(e)}`)).join("")}static get conversionConfig(){return{export:e=>f.joinRecursive(e),import:e=>({items:[{content:e,items:[]}],style:"unordered"})}}}export{f as default};